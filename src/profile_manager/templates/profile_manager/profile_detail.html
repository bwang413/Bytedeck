{% extends "profile_manager/base.html" %}

{% block heading_inner %}{{ object.user.username }}'s Profile
  <a class="btn btn-info" href="{% url 'profiles:profile_update' object.id %}" role="button">Edit</a>
{% endblock %}

{% block content %}

<div class="row">
  <div class="col-sm-3">
    <img class="icon-avatar img-rounded" src="{{object.get_avatar_url}}" alt="avatar"/>
  </div>
  <div class="col-sm-9">

    <div class="panel panel-primary">
      <div class="panel-heading">

        <h3 class="panel-title">
          <a href="{% url 'courses:ranks' %}">
             <div class="pull-right">
               <i class="{{object.rank.fa_icon}} fa-lg"></i>
               {{object.rank}}
             </div>
          </a>
          {{object.first_name}}
          {% if object.preferred_name %} ({{ object.preferred_name}}) {% endif %}
          {{object.last_name}}{% if object.alias %}, aka {{ object.alias}}{% endif %}
        </h3>

      </div>
      <div class="panel-body">

        <!-- <div class="row">
          <div class="col-sm-1">
            Group
          </div>
          <div class="col-sm-10">
            <div class="progress">
              <div class="progress-bar" role="progressbar" aria-valuenow="75" aria-valuemin="0" aria-valuemax="100"
                  style="width: 60%;">
                <span class="sr-only">60% Complete</span>
              </div>
            </div>
          </div>
          <div class="col-sm-2">
            X | 1000
          </div>
        </div> -->
        <div class="pull-right"> {{object.xp}} | 1000</div>
        <div>
          {% if courses %}
            {{courses.0.course}} {{courses.0.grade}}
          {% else %}
            You  have not joined a course yet.
            <a href="{% url 'courses:create' %}">Join a Course</a>
          {% endif %}
        </div>
        <div class="progress progress-xp">&nbsp; {% widthratio object.xp 1000 100 %}&#37;
          <div class="progress-bar" role="progressbar" aria-valuenow="{{object.xp}}" aria-valuemin="0" aria-valuemax="1000"
              style="width: {% widthratio object.xp 1000 100 %}%;">
            <span class="sr-only">{% widthratio object.xp 1000 100 %}% Complete</span>
          </div>
        </div>

        <div class="pull-right"> {{object.xp_since_last_rank}} | {{object.xp_to_next_rank}}</div>
        <div>Next Rank: {{object.next_rank}} </div>
        <div class="progress progress-xp">
          <div class="progress-bar" role="progressbar" aria-valuenow="75" aria-valuemin="0" aria-valuemax="100"
              style="width: {% widthratio object.xp_since_last_rank object.xp_to_next_rank 100 %}%;">
            <span class="sr-only">60% Complete</span>
          </div>
        </div>

      </div>

    </div> <!--panel -->

  </div>
</div>

<div class="row">
  <div class="col-sm-6">
    <div class="panel panel-primary">
      <div class="panel-heading">
        <h3 class="panel-title">General</h3>
      </div>
      <div class="panel-body">
        <p>SN: {{ object.student_number}}</p>
        <p>Grad: {{ object.grad_year}}</p>
        <p>Account Created: {{ object.datetime_created}} ({{ object.datetime_created|timesince}} ago)</p>
      </div>
     </div> <!--panel -->
     <div class="panel panel-primary">
       <div class="panel-heading">
         <i class="pull-right fa fa-fw fa-book"></i>
         <h3 class="panel-title">Courses</h3>
       </div>
       <ul class="list-group">
         {% if courses %}
             {% for course in courses %}
               <li class="list-group-item {% if not course.semester.active_by_date %}text-muted{% endif %}">
                 {{course.course}} {{course.grade}} <br/>
                 <small>{{course.block}} Block, Semester {{course.semester.number}}, {{course.semester}}</small>
               </li>
             {% endfor %}
         {% else %}
           <li class="list-group-item">You have not joined a course yet.
             <a href="{% url 'courses:create' %}" class="btn btn-info" role="button">Join a Course</a>
           </li>
         {% endif %}
       </ul>
      </div> <!--panel -->
    <!-- QUESTS -->
     <div class="panel panel-primary">
       <div class="panel-heading">
         <i class="pull-right fa fa-fw fa-shield"></i>
         <h3 class="panel-title">Quests</h3>
       </div>
       <div class="list-group">
         <div class="list-group-item list-group-item-info">In Progress</div>
         {% if in_progress_submissions %}
           {% for s in in_progress_submissions %}
             <a href="{{s.get_absolute_url}}" class="list-group-item list-group-item-packed
                 {% if s.is_returned %}list-group-item-danger
                 {% endif %}">
               <img class="icon-xs" src="{{ s.quest.icon_url|default_if_none:'#' }}" alt=""/>
               {{s.quest}} <small>({{s.quest.xp}} XP)</small>
             </a>
           {% endfor %}
         {% else %}
           <div class="list-group-item">None.</div>
         {% endif %}
         <div class="list-group-item list-group-item-info">Completed</div>
         {% if completed_submissions %}
           {% for s in completed_submissions %}
             <a href="{{s.get_absolute_url}}" class="list-group-item list-group-item-packed
                 {% if s.is_awaiting_approval %}list-group-item-warning
                 {% endif %}">
               <img class="icon-xs" src="{{ s.quest.icon_url|default_if_none:'#' }}" alt=""/>
               {{s.quest}} <small>({{s.quest.xp}} XP)</small>
             </a>
           {% endfor %}
         {% else %}
           <div class="list-group-item">None.</div>
         {% endif %}
        </div>

         <!-- <li class="list-group-item list-group-item-info">Completed</li>
         {% if completed_submissions %}
             {% for s in completed_submissions %}
               <li class="list-group-item list-group-item-packed">
                {{s.quest}} <small>({{s.quest.xp}} XP)</small>
               </li>
             {% endfor %}
         {% else %}
           <li class="list-group-item">None.</li>
         {% endif %}
       </ul> -->
      </div> <!--panel -->

      <div class="panel panel-primary">
        <div class="panel-heading">
          <h3 class="panel-title">Recent Activity</h3>
        </div>
        <div class="panel-body">
          <p>Badges</p>
        </div>
       </div> <!--panel -->
  </div>
  <!-- BADGES -->
  <div class="col-sm-6">
    <div class="panel panel-primary">
      <div class="panel-heading">
        <i class="pull-right fa fa-fw fa-trophy"></i>
        <h3 class="panel-title">Achievments</h3>
      </div>
      <div class="list-group">
      {% for badges in badge_assertions_by_type %}
        <div class="list-group-item list-group-item-info">
            <i class="pull-right fa fa-fw {{badges.badge_type.fa_icon}}"></i>
            {{badges.badge_type.name}}s
            {% if request.user.is_staff %}
              &nbsp;&nbsp;<a class="btn btn-xs btn-primary" href="{% url 'badges:list' %}" role="button">Grant</a>
            {% endif %}
          </h3>
        </div>
        <div class="list-group-item">
          {% for assertion in badges.list %}
            <a tabindex="0" class="badge-popover" role="button" data-toggle="popover"
            data-trigger="hover" data-placement="left" data-html="true"
            title="<h3 class='panel-title'>{{assertion.badge.name}}</h3>"
            data-content='
            <img class="icon-lg center-block" src="{{assertion.badge.icon.url}}">
            <p>{{assertion.badge.short_description}}</p>
            <p>XP: {{assertion.badge.xp}}</p>
            <p><small>Granted on: {{assertion.time_issued}}</small></p>
            '>
                <img class="icon-md" src="{{assertion.badge.icon.url}}">
            </a>
          {% empty %}
            None.
          {% endfor %}
        </div>
      {% endfor %}
      </div> <!--list-group -->
    </div> <!-- panel -->
  </div> <!-- col -->
</div> <!-- row -->

{% endblock %}

{% block js %}
<script>
$(document).ready(function() {
  $('[data-toggle="popover"]').popover(

  )
});
</script>
{% endblock %}
