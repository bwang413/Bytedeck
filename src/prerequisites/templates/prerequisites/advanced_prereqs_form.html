{% extends "prerequisites/base.html" %}
{% load crispy_forms_tags %}
{% load static %}

{% block head %}
  {{ form.media }}
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/select2-bootstrap-theme/0.1.0-beta.10/select2-bootstrap.min.css">
{% endblock %}

{% block heading_inner %}Advanced Prerequisites{% endblock %}

{% block content %}
<h3>{{object.prereq_parent_str}}</h3>

<div>Current prerequisites:</div>
{% include 'prerequisites/current_prereq_list.html' %}

{% crispy form form.helper %}

{% endblock %}


{% block js %}
<script>
  $.fn.select2.defaults.set( "theme", "bootstrap" );
    
  // Button to dynamically add additional forms to the formset
  var $addFormBtn = $("<a>").attr("id", "add-form");
  $addFormBtn.html('Add Another Prerequisite <i class="fa fa-plus-circle"></i>');
  $addFormBtn.addClass("btn btn-primary");
  $("div.form-actions").append($addFormBtn)

  $('#add-form').click(function() {
    var $totalFormsInput = $('#id_prerequisites-prereq-parent_content_type-parent_object_id-TOTAL_FORMS')
    var numForms = $totalFormsInput.val();
    // forms are zero index (e.g. 0, 1), so new form index = numForms (e.g. 2)
    var $newRow = $("<tr>").append($('tr.empty-form').html().replace(/__prefix__/g, numForms));
    $('#id_prereq_formset table>tbody').append($newRow);
    $totalFormsInput.val(parseInt(numForms) + 1);
  });

  // When DELETE buttons are ticked, highlight the row in red
  // also do when page loads in case they refresh page
  $( document ).ready(function() {
    $('input[id$="DELETE"]').each(function() {
      highlightRowsToDelete($(this));
    });
  });

  $('input[id$="DELETE"]').click(function() {
    highlightRowsToDelete($(this));
  });

  function highlightRowsToDelete($checkbox) {
    if ($checkbox.is(':checked')) {
      $checkbox.closest('tr').addClass('danger');
    } else {
      $checkbox.closest('tr').removeClass('danger');
    }
  }

  // Change Delete to a trash can
  $( document ).ready(function() {
    $("[for='id_prerequisites-prereq-parent_content_type-parent_object_id-0-DELETE']").addClass(
      // '<i class="fa fa-lg fa-trash-o text-danger"></i>'
      'text-danger'
    )
  });


</script>
{% endblock %}
